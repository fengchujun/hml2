<?php
/**
 * 手机号归属地查询服务
 */

namespace app\service;

class PhoneAreaService
{
    /**
     * 手机号段和区号对应关系
     * 格式：手机号前3位 => 区号（已去掉前导0）
     */
    private static $phoneAreaMap = [
        // 北京 010 -> 10
        '130' => '10', '131' => '10', '132' => '10', '145' => '10', '155' => '10',
        '156' => '10', '185' => '10', '186' => '10',

        // 上海 021 -> 21
        '134' => '21', '135' => '21', '136' => '21', '137' => '21', '138' => '21',
        '139' => '21', '147' => '21', '150' => '21', '151' => '21', '152' => '21',
        '157' => '21', '158' => '21', '159' => '21', '182' => '21', '183' => '21',
        '187' => '21', '188' => '21',

        // 深圳 0755 -> 755
        '133' => '755', '153' => '755', '173' => '755', '177' => '755', '180' => '755',
        '181' => '755', '189' => '755', '191' => '755', '199' => '755',

        // 广州 020 -> 20
        '160' => '20', '161' => '20', '162' => '20', '165' => '20', '166' => '20',
        '167' => '20', '171' => '20', '175' => '20', '176' => '20', '196' => '20',

        // 成都 028 -> 28
        '140' => '28', '141' => '28', '142' => '28', '143' => '28', '144' => '28',
        '146' => '28', '148' => '28', '170' => '28', '172' => '28', '178' => '28',
        '190' => '28', '195' => '28', '197' => '28', '198' => '28',

        // 杭州 0571 -> 571
        '149' => '571', '174' => '571', '184' => '571', '192' => '571', '193' => '571',

        // 重庆 023 -> 23
        '163' => '23', '164' => '23', '168' => '23', '169' => '23', '194' => '23',
    ];

    /**
     * 根据手机号获取区号
     * @param string $mobile 手机号
     * @return string 区号（去掉前导0），如果查询不到返回 86
     */
    public static function getAreaCode($mobile)
    {
        if (empty($mobile) || strlen($mobile) < 7) {
            return '86'; // 默认返回中国区号
        }

        // 取手机号前3位
        $prefix = substr($mobile, 0, 3);

        // 查询映射表
        if (isset(self::$phoneAreaMap[$prefix])) {
            return self::$phoneAreaMap[$prefix];
        }

        // 如果查询不到，返回默认值
        return '86';
    }

    /**
     * 批量添加手机号段映射
     * @param string $areaCode 区号（去掉前导0）
     * @param array $prefixes 手机号前缀数组
     */
    public static function addAreaMapping($areaCode, array $prefixes)
    {
        foreach ($prefixes as $prefix) {
            self::$phoneAreaMap[$prefix] = $areaCode;
        }
    }
}
